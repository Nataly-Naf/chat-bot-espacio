const { Telegraf, Markup, session } = require("telegraf");
const registerTestHandlers = require("./commands/test");
const registerInfoSchoolHandlers = require("./commands/info");
const mainMenu = require("./commands/mainMenu");
const registerEducationMenuHandlers = require("./commands/courses"); 
const registerContactManagerHandlers = require("./commands/manager"); 
const registerRequestHandlers = require("./commands/request"); 
const path = require('path');
require('dotenv').config(); 

const ADMIN_ID = 7292502498;

// –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –¥–ª—è —Ç–µ—Å—Ç—É
const globalState = { pendingResultMessage: null };

const teachers = {
  '–û–ª–µ–∫—Å–∞–Ω–¥—Ä': {
    photo: path.join(__dirname, 'pictures', 'Oleksandr.jpeg'),
    description: '–Ø –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –≤–∏–∫–ª–∞–¥–∞—á –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó —Ç–∞ —ñ—Å–ø–∞–Ω—Å—å–∫–æ—ó –º–æ–≤ —ñ–∑ 7-—Ä—ñ—á–Ω–∏–º –¥–æ—Å–≤—ñ–¥–æ–º, –∑–¥–µ–±—ñ–ª—å—à–æ–≥–æ –ø—Ä–∞—Ü—é—é –æ–Ω–ª–∞–π–Ω. –ü—Ä–æ–≤–æ–¥–∂—É —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ –∫—É—Ä—Å–∏ –¥–ª—è —É—á–Ω—ñ–≤ —Ä—ñ–∑–Ω–æ–≥–æ –≤—ñ–∫—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å—É—á–∞—Å–Ω—ñ –∫–æ–º—É–Ω—ñ–∫–∞—Ç–∏–≤–Ω—ñ –º–µ—Ç–æ–¥–∏–∫–∏, –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.'
  },
  '–û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞': {
    photo: path.join(__dirname, 'pictures', 'Oleksandra.jpeg'),
    description: `–í–∏–∫–ª–∞–¥–∞—é —ñ—Å–ø–∞–Ω—Å—å–∫—É –∑ 2014 —Ä–æ–∫—É. –ü—Ä–∞—Ü—é—é —è–∫ —ñ–∑ –¥—ñ—Ç—å–º–∏, —Ç–∞–∫ —ñ –∑ –¥–æ—Ä–æ—Å–ª–∏–º–∏.

–ó–∞–≤–∂–¥–∏ –Ω–∞–º–∞–≥–∞—é—Å—å —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –≥–∞—Ä–Ω–∏–π –Ω–∞—Å—Ç—Ä—ñ–π –Ω–∞ —É—Ä–æ—Ü—ñ, —ñ –≤–≤–∞–∂–∞—é, —â–æ –æ—Å–Ω–æ–≤–æ—é –≥–∞—Ä–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è —î –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è –≤—ñ–¥ –ø—Ä–æ—Ü–µ—Å—É.`
  },
  '–ê–Ω–Ω–∞': {
    photo: path.join(__dirname, 'pictures', 'Anna.jpeg'),
    description: `–ó–∞–∫—ñ–Ω—á–∏–ª–∞ –•–∞—Ä–∫—ñ–≤—Å—å–∫–∏–π –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç —ñ–º. –°–∫–æ–≤–æ—Ä–æ–¥–∏, —Ñ–∞–∫—É–ª—å—Ç–µ—Ç —ñ–Ω–æ–∑–µ–º–Ω–æ—ó —Ñ—ñ–ª–æ–ª–æ–≥—ñ—ó.
–î–æ—Å–≤—ñ–¥ –≤–∏–∫–ª–∞–¥–∞–Ω–Ω—è ‚Äî 8 —Ä–æ–∫—ñ–≤.
–õ—é–±–ª—é —ñ–Ω–æ–∑–µ–º–Ω—ñ –º–æ–≤–∏ –∑ –¥–∏—Ç–∏–Ω—Å—Ç–≤–∞, —ñ –≤ —ñ—Å–ø–∞–Ω—Å—å–∫—É –º–æ–≤—É –∑–∞–∫–æ—Ö–∞–ª–∞—Å—è –∑ –ø–µ—Ä—à–∏—Ö —Å–ª—ñ–≤. –†–∞–¥–∞, —â–æ –º–æ—è –ø—Ä–æ—Ñ–µ—Å—ñ—è –ø–æ–≤'—è–∑–∞–Ω–∞ —Å–∞–º–µ –∑ –≤–∏–∫–ª–∞–¥–∞–Ω–Ω—è–º —Ü—ñ—î—ó –Ω–µ–π–º–æ–≤—ñ—Ä–Ω–æ –≥–∞—Ä–Ω–æ—ó –º–æ–≤–∏. –ö–æ–ª–∏—Å—å, –≤–∏–ø–∞–¥–∫–æ–≤–æ –æ–±—Ä–∞–≤—à–∏ —ñ—Å–ø–∞–Ω—Å—å–∫—É, —è –∑—Ä–æ–±–∏–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä. –ú–æ—è —Ä–æ–±–æ—Ç–∞ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –º–µ–Ω—ñ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è. –û–±–æ–∂–Ω—é—é –Ω–∞–≤—á–∞—Ç–∏ –ª—é–¥–µ–π, –æ—Å–æ–±–ª–∏–≤–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ –¥–ª—è –Ω–∏—Ö —Å–≤—ñ—Ç —ñ—Å–ø–∞–Ω—Å—å–∫–æ—ó –º–æ–≤–∏ —Ç–∞ –∫—É–ª—å—Ç—É—Ä–∏. –õ—é–±–ª—é —ñ—Å–ø–∞–Ω—Å—å–∫—É –º—É–∑–∏–∫—É, —Ñ—ñ–ª—å–º–∏ —Ç–∞ —Å–µ—Ä—ñ–∞–ª–∏, –∫—É—Ö–Ω—é —Ç–∞ —Å—Ç–∏–ª—å –∂–∏—Ç—Ç—è ‚ù§Ô∏è.`
  },
  '–ú–∞—Ä—ñ—è –ì': {
    photo: path.join(__dirname, 'pictures', 'Maria.jpeg'),
    description: `–ú–µ–Ω–µ –∑–≤–∞—Ç–∏ –ú–∞—Ä—ñ—è. –í–∏–≤—á–∞—é —ñ—Å–ø–∞–Ω—Å—å–∫—É –ø–æ–Ω–∞–¥ 15 —Ä–æ–∫—ñ–≤, –∞ –Ω–∞–≤—á–∞—é 4. 
–õ—é–±–ª—é –ø–æ–¥–æ—Ä–æ–∂—ñ, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—É–≤–∞—Ç–∏ –Ω–∞ –ø–ª—ñ–≤–∫—É —Ç–∞ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –º–æ—ó—Ö —É—á–Ω—ñ–≤.`
  },
  '–ê–Ω–∞—Å—Ç–∞—Å—ñ—è': {
    photo: path.join(__dirname, 'pictures', 'Anastasia.jpeg'),
    description: `¬°Hola, soy Anastasia! –ú–∞—é –±–∞–≥–∞—Ç–∏–π –¥–æ—Å–≤—ñ–¥ –≤–∏–∫–ª–∞–¥–∞–Ω–Ω—è —ñ—Å–ø–∞–Ω—Å—å–∫–æ—ó –º–æ–≤–∏ —Ç–∞ –ª—é–±–æ–≤ –¥–æ —Ü—ñ—î—ó –∫—É–ª—å—Ç—É—Ä–∏. 
–ù–∞–≤—á–∞–Ω–Ω—è –¥–ª—è –º–µ–Ω–µ ‚Äî —Ü–µ –Ω–µ –ª–∏—à–µ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞–Ω—å, –∞ –π –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ —Å–≤–æ—é –ª—é–±–æ–≤ –¥–æ –º–æ–≤–∏ —Ç–∞ —Ç—Ä–∞–¥–∏—Ü—ñ–π –Ü—Å–ø–∞–Ω—ñ—ó. 
–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∂—É –¥–æ –∫–æ–∂–Ω–æ–≥–æ —É—á–Ω—è, —â–æ–± –∑–∞–Ω—è—Ç—Ç—è –±—É–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º–∏ —Ç–∞ —Ü—ñ–∫–∞–≤–∏–º–∏. –†–∞–¥—ñ—é –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –≤–∞–º –Ω–∞ —à–ª—è—Ö—É –¥–æ –≤—ñ–ª—å–Ω–æ–≥–æ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è —ñ—Å–ø–∞–Ω—Å—å–∫–æ—é!`
  },
  '–ö–∞—Ç–µ—Ä–∏–Ω–∞': {
    photo: path.join(__dirname, 'pictures', 'Kateryna.jpg'),
    description: `Hola, amig@s!
Soy Kateryna de la hermosa ciudad de Odesa.
–Ø –≤–∏–∫–ª–∞–¥–∞—é —ñ—Å–ø–∞–Ω—Å—å–∫—É –º–æ–≤—É –π –∑–∞–∫–æ—Ö—É—é —É –Ω–µ—ó —Å–≤–æ—ó—Ö —É—á–Ω—ñ–≤, —Ç–æ–º—É —â–æ –¥–ª—è –º–µ–Ω–µ —ñ—Å–ø–∞–Ω—Å—å–∫–∞ —Å—Ç–∞–ª–∞ –¥–ª—è –Ω–µ –ø—Ä–æ—Å—Ç–æ –º–æ–≤–æ—é, –∞ —á–∞—Å—Ç–∏–Ω–æ—é –∂–∏—Ç—Ç—è.
–ú–æ—è –º–µ—Ç–∞ - –ø–æ–∫–∞–∑–∞—Ç–∏, —â–æ –≤—á–∏—Ç–∏—Å—è –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ —Ç–∞ –∑ –ª—é–±–æ–≤ º—é ü§ç`
  },
  '–ú–∞—Ä—ñ—è –°': {
    photo: path.join(__dirname, 'pictures', 'MariiaS.jpeg'),
    description: `–ü—Ä–∏–≤—ñ—Ç! üòä –ú–µ–Ω–µ –∑–≤–∞—Ç–∏ –ú–∞—Ä—ñ—è, —ñ —è –≤–∏–∫–ª–∞–¥–∞—á —ñ—Å–ø–∞–Ω—Å—å–∫–æ—ó.
–Ø –ª—é–±–ª—é –¥–æ—Å–ª—ñ–¥–∂—É–≤–∞—Ç–∏ –º–æ–≤–∏ —ñ –º–æ—è —Ü—ñ–ª—å ‚Äî –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –≤–∏–≤—á–∞—Ç–∏ —ñ—Å–ø–∞–Ω—Å—å–∫—É –ª–µ–≥–∫–æ —Ç–∞ –∑—Ä–æ–∑—É–º—ñ–ª–æ.
–ù–∞ –º–æ—ó—Ö —É—Ä–æ–∫–∞—Ö –±–∞–≥–∞—Ç–æ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∂–∏–≤–∏—Ö –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ —ñ —Ç—Ä–æ—Ö–∏ –≥—É–º–æ—Ä—É ‚Äì –±–æ –≤–∏–≤—á–∞—Ç–∏ –º–æ–≤—É –º–∞—î –±—É—Ç–∏ —Ü—ñ–∫–∞–≤–æ!
–Ø –ø–æ—è—Å–Ω—é—é –≤—Å–µ –ø—Ä–æ—Å—Ç–æ, –±–µ–∑ —Å–∫–ª–∞–¥–Ω–∏—Ö –ø—Ä–∞–≤–∏–ª, —â–æ–±–∏ —É —Ç–µ–±–µ –ø–æ—á–∞–ª–æ—Å—è –∑–∞–≥–æ–≤–æ—Ä–∏—Ç–∏ –≤–∂–µ –∑ –ø–µ—Ä—à–æ–≥–æ –∑–∞–Ω—è—Ç—Ç—è.
–ì–æ–ª–æ–≤–Ω–µ ‚Äî –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–æ–≤–∞–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞, –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å —ñ –¥—Ä—ñ–±–∫–∞ —Ç–µ—Ä–ø—ñ–Ω–Ω—è, –∞ —è –¥–æ–ø–æ–º–æ–∂—É —Ç–æ–±—ñ –∑–∞–≥–æ–≤–æ—Ä–∏—Ç–∏ –±–µ–∑ —Å—Ç—Ä–∞—Ö—É —ñ –∑ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è–º!
–•–æ—á–µ—à –≤–∏–≤—á–∞—Ç–∏ —ñ—Å–ø–∞–Ω—Å—å–∫—É –ª–µ–≥–∫–æ —ñ –∑ –∫–æ—Ä–∏—Å—Ç—é? –¢–æ–¥—ñ –∑–∞–ø—Ä–æ—à—É—é —Ç–µ–±–µ –Ω–∞ –º–æ—ó —É—Ä–æ–∫–∏! ‚ú®üí°`
  },
  '–û–ª–µ–Ω–∞': {
    photo: path.join(__dirname, 'pictures', 'Lena.jpeg'),
    description: `¬°Hola! Me llamo Olena. Soy de Ucrania, pero llevo 9 a√±os viviendo en Espa√±a.
–í –ú–∞–¥—Ä–∏–¥—ñ, –≤ Universidad Carlos III (UC3M), –∑—Ä–æ–±–∏–ª–∞ —Å–≤—ñ–π –º–∞–≥—ñ—Å—Ç–µ—Ä—Å—å–∫–∏–π —Ç–∞ –¥–æ–∫—Ç–æ—Ä—Å—å–∫–∏–π —Å—Ç—É–ø—ñ–Ω—å —É —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –Ω–∞—É–∫–∞—Ö. 
–ù–∞—Ä–∞–∑—ñ –ø—Ä–∞—Ü—é—é –≤ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ —è–∫ –¥–æ—Å–ª—ñ–¥–Ω–∏—Ü—è —Ç–∞ –≤–∏–∫–ª–∞–¥–∞—á–∫–∞, –¥–∞—é –∑–∞–Ω—è—Ç—Ç—è —ñ—Å–ø–∞–Ω—Å—å–∫–æ—é —Ç–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é. –£ 2019 –æ—Ç—Ä–∏–º–∞–ª–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç DELE B2, –∞ –≤ 2023 ‚Äî C1 Escuela Oficial de Idiomas.`
  },
  'Susana': {
    photo: path.join(__dirname, 'pictures', 'Susana.jpeg'),
    description: `Soy Susi, profesora de espa√±ol e ingl√©s, nacida en Colombia y actualmente viviendo en Espa√±a.
El espa√±ol es mi lengua materna y ense√±ar es mi gran pasi√≥n. Disfruto cada momento de guiar a mis estudiantes en su camino hacia la fluidez.
Adem√°s, me encanta viajar y explorar nuevas culturas, lo que enriquece mi forma de ense√±ar con historias y perspectivas del mundo.`
  },
};

const bot = new Telegraf(process.env.BOT_TOKEN);
const channelId = process.env.CHANNEL_ID;

bot.use(
  session({
    getSessionKey: (ctx) => ctx.from && ctx.chat && `${ctx.from.id}:${ctx.chat.id}`,
  })
);

// --- –¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª ---
bot.command("test_channel", async (ctx) => {
  try {
    await bot.telegram.sendMessage(channelId, "–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª");
    ctx.reply("–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –≤ –∫–∞–Ω–∞–ª.");
  } catch (error) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ:", error);
    ctx.reply("–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª.");
  }
});

// --- –í–∏–∫–ª–∞–¥–∞—á—ñ ---
const chunkArray = (arr, chunkSize) => {
  const result = [];
  for (let i = 0; i < arr.length; i += chunkSize) result.push(arr.slice(i, i + chunkSize));
  return result;
};

bot.hears("–ù–∞—à—ñ –≤–∏–∫–ª–∞–¥–∞—á—ñ üë©‚Äçüè´", (ctx) => {
  ctx.reply(
    "üë©‚Äçüè´ –ù–∞—à—ñ –≤–∏–∫–ª–∞–¥–∞—á—ñ - —Ü–µ –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª–∏. –û–±–µ—Ä—ñ—Ç—å –≤–∏–∫–ª–∞–¥–∞—á–∞:",
    Markup.keyboard([...chunkArray(Object.keys(teachers), 2), ['–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô']]).resize()
  );
});

Object.keys(teachers).forEach(name => {
  bot.hears(name, (ctx) => {
    const teacher = teachers[name];
    ctx.replyWithPhoto({ source: teacher.photo }, {
      caption: teacher.description,
      reply_markup: Markup.keyboard([...Object.keys(teachers).map(n => [n]), ["–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô"]]).resize()
    });
  });
});

// --- –ö–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä ---
bot.hears("–ù–∞–ø–∏—Å–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É üì®", (ctx) => {
  ctx.reply("üí¨ –Ø–∫—â–æ —É –≤–∞—Å —î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –Ω–∞–ø–∏—à—ñ—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É: @espacioescuela");
});

bot.hears("–ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏ üìû", (ctx) => {
  ctx.reply("üìû –ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏:\nüåê di-espacio.com\nüìß espacio.school@gmail.com\nhttps://t.me/espacioescuela");
});

bot.hears("–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô", (ctx) => {
  ctx.reply("–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –≤ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é. –û–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é:", mainMenu());
});

// --- –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–Ω—Ç–∞–∫—Ç—É –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ç–µ—Å—Ç—É ---
bot.on("contact", (ctx) => {
  const contact = ctx.message.contact;

  ctx.telegram.sendMessage(
    ADMIN_ID,
    `–ù–æ–≤–∏–π –∫–æ–Ω—Ç–∞–∫—Ç –∑ —Ç–µ—Å—Ç—É:\n–Ü–º'—è: ${contact.first_name}\n–¢–µ–ª–µ—Ñ–æ–Ω: ${contact.phone_number}\nUsername: @${ctx.from.username || "–Ω–µ–º–∞—î"}`
  );

  // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Ç–µ—Å—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
  if (globalState.pendingResultMessage) {
    ctx.reply(globalState.pendingResultMessage).then(() => {
      globalState.pendingResultMessage = null;
      ctx.reply(
        "–î—è–∫—É—î–º–æ! –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∫–æ—Ä–æ –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ üôå",
        Markup.keyboard([["–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô"]]).resize()
      );
    });
  } else {
    ctx.reply(
      "–î—è–∫—É—î–º–æ! –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∫–æ—Ä–æ –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ üôå",
      Markup.keyboard([["–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô"]]).resize()
    );
  }
});

// --- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤ ---
require("./commands/start")(bot);
registerInfoSchoolHandlers(bot);
registerEducationMenuHandlers(bot); 
registerTestHandlers(bot, globalState); // –ø–µ—Ä–µ–¥–∞—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω
registerRequestHandlers(bot);

// --- –ú–µ–Ω—é /menu ---
const createMainMenuKeyboard = () => Markup.keyboard([["–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å üîÑ"]]).resize();
bot.command("menu", (ctx) => ctx.reply("–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é:", createMainMenuKeyboard()));
bot.hears("–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å üîÑ", (ctx) => {
  ctx.reply("–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é –º–µ–Ω—é...");
  ctx.reply("–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –≤ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é. –û–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é:", createMainMenuKeyboard());
});

// --- –ó–∞–ø—É—Å–∫ ---
bot.launch();
console.log("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ");
