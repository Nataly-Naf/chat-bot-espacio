// const { Telegraf } = require("telegraf");
//  https://t.me/espacioescuela_bot
// const bot = new Telegraf("7788598442:AAHv6stx2aDV-zyyeAkIA7ZbAMnyN56kKRM");
// const channelId = "-4539289526"; // –ó–∞–º—ñ–Ω–∏ –Ω–∞ ID —Ç–≤–æ–≥–æ –∫–∞–Ω–∞–ª—É

const { Telegraf, Markup, session } = require("telegraf");
const config = require("./config");
const registerTestHandlers = require("./commands/test");
const registerInfoSchoolHandlers = require("./commands/info");
const mainMenu = require("./commands/mainMenu");
const registerEducationMenuHandlers = require("./commands/courses"); 
const registerContactManagerHandlers = require("./commands/manager"); 
const registerRequestHandlers = require("./commands/request"); 


const bot = new Telegraf(config.BOT_TOKEN);
const channelId = config.CHANNEL_ID;

bot.use(
  session({
    getSessionKey: (ctx) => ctx.from && ctx.chat && `${ctx.from.id}:${ctx.chat.id}`,
  })
);

// –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–µ—Å—ñ—ó


bot.command("test_channel", async (ctx) => {
  console.log("–ö–æ–º–∞–Ω–¥–∞ /test_channel –æ—Ç—Ä–∏–º–∞–Ω–∞");

  try {
    await bot.telegram.sendMessage(channelId, "–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª");
    ctx.reply("–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –≤ –∫–∞–Ω–∞–ª.");
  } catch (error) {
    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª:", error);
    ctx.reply("–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª.");
  }
});
bot.hears("–ù–∞—à—ñ –≤–∏–∫–ª–∞–¥–∞—á—ñ üë©‚Äçüè´", (ctx) => {
  ctx.reply("üë©‚Äçüè´ –ù–∞—à—ñ –≤–∏–∫–ª–∞–¥–∞—á—ñ - —Ü–µ –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª–∏ –∑ –±–∞–≥–∞—Ç–æ—Ä—ñ—á–Ω–∏–º –¥–æ—Å–≤—ñ–¥–æ–º...");
});

bot.hears("–û—Ç—Ä–∏–º–∞—Ç–∏ –±–æ–Ω—É—Å üéÅ", (ctx) => {
  ctx.reply("üéÅ –í–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –±–æ–Ω—É—Å–Ω–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ —É—Ä–æ–∫—É!");
});


// bot.hears("–•–æ—á—É –Ω–∞–≤—á–∞—Ç–∏—Å—å üë®‚Äçüéì", (ctx) => {
//   ctx.reply(
//     "üìã *–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ª–∏—à—Ç–µ —Å–≤–æ—é –∑–∞—è–≤–∫—É —É —Ç–∞–∫–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ:* \n\n" +
//     "1Ô∏è‚É£ *–Ü–º'—è*\n" +
//     "2Ô∏è‚É£ *–í–∞—à –∫–æ–Ω—Ç–∞–∫—Ç –≤ —Ç–µ–ª–µ–≥—Ä–∞–º—ñ (–∞–±–æ —ñ–Ω—à–∏–π –∫–æ–Ω—Ç–∞–∫—Ç –¥–ª—è –∑–≤'—è–∑–∫—É)*\n" +
//     "3Ô∏è‚É£ *–ö–æ–º–µ–Ω—Ç–∞—Ä* _(–∑–∞ –±–∞–∂–∞–Ω–Ω—è–º)_\n\n" +
//     "üìû –ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º!",
//     { parse_mode: "Markdown" }
//   );

//   // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Å—ñ—ó, —è–∫—â–æ —ó—ó —â–µ –Ω–µ–º–∞—î
//   if (!ctx.session) ctx.session = {};

//   // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω —Å–µ—Å—ñ—ó
//   ctx.session.state = "awaiting_application";
//   console.log(ctx.session.state);
//   console.log(ctx.message.text);


// });

// bot.hears(/.+/, async (ctx) => { // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ä–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ —Ç–µ–∫—Å—Ç—É
//   console.log("–û–±—Ä–æ–±–∫–∞ —Ç–µ–∫—Å—Ç—É");

//   // –û–±—Ä–æ–±–ª—è—î–º–æ –∑–∞—è–≤–∫—É, —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Å—Ç–∞–Ω —Å–µ—Å—ñ—ó - "awaiting_application"
//   if (ctx.session.state === "awaiting_application") {
//     const application = ctx.message.text;
//     console.log(`–ó–∞—è–≤–∫–∞: ${application}`);

//     try {
//       await bot.telegram.sendMessage(channelId, `–ù–æ–≤–∞ –∑–∞—è–≤–∫–∞:\n${application}`);
//       ctx.reply("–î—è–∫—É—î–º–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∞.", mainMenu());
//     } catch (error) {
//       console.error("–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–∞—è–≤–∫–∏ –¥–æ –∫–∞–Ω–∞–ª—É:", error);
//       ctx.reply("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –∑–∞—è–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
//     }

//     // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∞–Ω —Å–µ—Å—ñ—ó –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞—è–≤–∫–∏
//     ctx.session.state = null;
//     console.log("–°—Ç–∞–Ω —Å–µ—Å—ñ—ó —Å–∫–∏–Ω—É—Ç–∏–π –ø—ñ—Å–ª—è –∑–∞—è–≤–∫–∏");
//   } else {
//     console.log("–°—Ç–∞–Ω —Å–µ—Å—ñ—ó –Ω–µ 'awaiting_application'. –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è —ñ–Ω—à–∞ –¥—ñ—è.");
//     ctx.reply("–í–∏ –∑–∞—Ä–∞–∑ –Ω–µ –Ω–∞–¥—Å–∏–ª–∞—î—Ç–µ –∑–∞—è–≤–∫—É. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∫–Ω–æ–ø–∫—É, —â–æ–± –ø–æ—á–∞—Ç–∏.");
//   }
// });





bot.hears("–ù–∞–ø–∏—Å–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É üì®", (ctx) => {
  console.log("–û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è '–ó–≤'—è–∑–∞—Ç–∏—Å—è –∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º' —Å–ø—Ä–∞—Ü—é–≤–∞–≤");
  ctx.reply("üí¨ –Ø–∫—â–æ —É –≤–∞—Å —î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ –Ω–∞—à–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º —É —á–∞—Ç—ñ @espacioescuela (https://t.me/espacioescuela).");
});

bot.hears("–ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏ üìû", (ctx) => {
  ctx.reply("üìû –ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏:\n–¢–µ–ª–µ—Ñ–æ–Ω: +380123456789\nEmail: contacto@espacio.com");
});


require("./commands/start")(bot);
registerInfoSchoolHandlers(bot);
registerEducationMenuHandlers(bot); 
registerTestHandlers(bot);

registerRequestHandlers(bot);







const createMainMenuKeyboard = () => {
  return Markup.keyboard([
    ["–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å üîÑ"], // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
  ]).resize();
};

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /menu –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π
bot.command("menu", (ctx) => {
  ctx.reply("–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é:", createMainMenuKeyboard());
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å üîÑ"
bot.hears("–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å üîÑ", (ctx) => {
  ctx.reply("–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é –º–µ–Ω—é...");
  ctx.reply("–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –≤ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é. –û–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é:", createMainMenuKeyboard());
});


// bot.hears("–ü—Ä–æ —à–∫–æ–ª—É üè´", (ctx) => {
//   ctx.reply("üè´ –ù–∞—à–∞ —à–∫–æ–ª–∞ –ø—Ä–æ–ø–æ–Ω—É—î —Å—É—á–∞—Å–Ω—ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è...");
// });

// bot.hears("–ü—Ä–æ –Ω–∞–≤—á–∞–Ω–Ω—è üìñ", (ctx) => {
//   ctx.reply("üìñ –ü—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –∞–¥–∞–ø—Ç–æ–≤–∞–Ω—ñ –¥–æ –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±...");
// });


// bot.hears("–î—ñ–∑–Ω–∞—Ç–∏—Å—è —Å–≤—ñ–π —Ä—ñ–≤–µ–Ω—å üìä", (ctx) => {
//   ctx.reply("üìñ –ü—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –∞–¥–∞–ø—Ç–æ–≤–∞–Ω—ñ –¥–æ –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±...");
// });






// bot.hears("–ó–≤'—è–∑–∞—Ç–∏—Å—è –∑ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º üì®", (ctx) => {
//   console.log("pushed")
//   ctx.reply(
//     "üí¨ –Ø–∫—â–æ —É –≤–∞—Å —î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ –Ω–∞—à–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º —É —á–∞—Ç—ñ @espacioescuela (https://t.me/espacioescuela)."
//   );
// });
// bot.hears("–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô", (ctx) => {
//   ctx.reply(
//     "–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –≤ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é. –û–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é:",
//     mainMenuKeyboard 
//   );
// });
bot.hears("–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é üîô", (ctx) => {
  ctx.reply(
    "–í–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –≤ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é. –û–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é:",
    mainMenu() // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é mainMenu()
  );
});



bot.launch();
console.log("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω");

